<script>
        let base64Doc = "";
        function baixarDoc() {
            const link = document.createElement('a');
            link.href = 'data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,' + base64Doc;
            link.download = "Desafio_Gerado.docx"; link.click();
        }

        document.getElementById('formGerar').onsubmit = function(e) {
            e.preventDefault();
            document.getElementById('btn-submit').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            
            fetch('/processar', { method: 'POST', body: new FormData(this) })
            .then(async res => {
                if (!res.ok) throw new Error("Tempo limite excedido ou servidor caiu. Tente novamente.");
                return res.json();
            })
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('btn-submit').style.display = 'block';
                if(data.erro) { alert(data.erro); return; }
                base64Doc = data.arquivo_base64;
                document.getElementById('resultado').style.display = 'block';
                baixarDoc();
            })
            .catch(err => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('btn-submit').style.display = 'block';
                alert("Erro de conex√£o: " + err.message);
            });
        };
    </script>
