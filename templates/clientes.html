{% extends "base.html" %}
{% block content %}
    <h1 style="margin-top:0;">Meus Clientes</h1>
    
    <div class="card">
        <h3 style="margin-top: 0;">Cadastrar Novo Cliente</h3>
        <form method="POST" style="display: flex; gap: 10px; flex-wrap: wrap;">
            <input type="text" name="nome" placeholder="Nome do Aluno" required style="flex: 2; min-width: 150px;">
            <input type="text" name="curso" placeholder="Curso/Disciplina" style="flex: 2; min-width: 150px;">
            <input type="text" name="telefone" placeholder="WhatsApp" style="flex: 2; min-width: 150px;">
            <input type="number" name="valor" placeholder="Valor (R$)" value="70.0" step="0.01" required style="flex: 1; min-width: 100px;">
            <button type="submit" class="btn btn-green" style="height: 42px;">Cadastrar</button>
        </form>
    </div>

    <h3 style="color: #FF4B4B;">‚è≥ Trabalhos a Receber (Pendentes)</h3>
    {% for aluno in alunos_pendentes %}
        <div class="card" style="display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #FF4B4B;">
            <div>
                <h4 style="margin: 0; color: #2196F3;">{{ aluno.nome }}</h4>
                <small style="color: #9E9E9E; display: flex; align-items: center;">
                    {{ aluno.curso }} | {{ aluno.telefone }} | 
                    <b style="margin-left: 5px;">R$ {{ "%.2f"|format(aluno.valor or 70.0) }}</b>
                    
                    <button type="button" onclick="editarValor({{ aluno.id }}, {{ aluno.valor or 70.0 }})" style="background: none; border: none; cursor: pointer; padding: 0 5px; font-size: 1.1rem;" title="Editar Valor do Trabalho">‚úèÔ∏è</button>
                </small>
            </div>
            <div style="display: flex; gap: 10px;">
                <form action="/toggle_status/{{ aluno.id }}" method="POST">
                    <button type="submit" class="btn btn-green" title="Marcar como Pago">üí∞ Marcar Pago</button>
                </form>
                <a href="/cliente/{{ aluno.id }}" class="btn btn-blue">Abrir Pasta</a>
            </div>
        </div>
    {% else %}
        <p style="color: #9E9E9E;">Nenhum trabalho pendente.</p>
    {% endfor %}

    <hr style="border: 0; border-top: 1px solid var(--border); margin: 30px 0;">

    <h3 style="color: #57D2A9;">‚úÖ Clientes Pagos (Recebidos)</h3>
    {% for aluno in alunos_pagos %}
        <div class="card" style="display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #57D2A9; opacity: 0.7;">
            <div>
                <h4 style="margin: 0; color: #2196F3;">{{ aluno.nome }}</h4>
                <small style="color: #9E9E9E; display: flex; align-items: center;">
                    {{ aluno.curso }} | {{ aluno.telefone }} | 
                    <b style="margin-left: 5px;">R$ {{ "%.2f"|format(aluno.valor or 70.0) }}</b>
                    
                    <button type="button" onclick="editarValor({{ aluno.id }}, {{ aluno.valor or 70.0 }})" style="background: none; border: none; cursor: pointer; padding: 0 5px; font-size: 1.1rem;" title="Editar Valor do Trabalho">‚úèÔ∏è</button>
                </small>
            </div>
            <div style="display: flex; gap: 10px;">
                <form action="/toggle_status/{{ aluno.id }}" method="POST">
                    <button type="submit" class="btn" style="background: #444C56;" title="Desarquivar">‚Ü©Ô∏è Estornar</button>
                </form>
                <a href="/cliente/{{ aluno.id }}" class="btn btn-blue">Abrir Pasta</a>
            </div>
        </div>
    {% else %}
        <p style="color: #9E9E9E;">Nenhum cliente recebido ainda.</p>
    {% endfor %}

    <script>
        function editarValor(idAluno, valorAtual) {
            let novoValor = prompt("Digite o novo valor corrigido para este trabalho (ex: 85.50):", valorAtual);
            
            if (novoValor !== null && novoValor.trim() !== "") {
                // Cria um formul√°rio r√°pido e envia para o Python atualizar no banco de dados
                let form = document.createElement('form');
                form.method = 'POST';
                form.action = '/editar_valor/' + idAluno;
                
                let input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'novo_valor';
                input.value = novoValor;
                
                form.appendChild(input);
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
{% endblock %}